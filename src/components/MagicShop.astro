---
const dataUrl = 'https://raw.githubusercontent.com/gm0nk/5etools/master/data/spells/spells-xge.json';
const defaultScrollsStock = {
    min: 3,
    max: 10
}
const {stock: scrollsStock = defaultScrollsStock} = Astro.props;

// –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –Ω–∏–∂–µ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è NodeJS –≤–æ –≤—Ä–µ–º—è —Å–±–æ—Ä–∫–∏
console.log("–ü–æ–ª–µ–∑–Ω—ã–π –≤—ã–≤–æ–¥ –≤ –∫–æ–º–∞–Ω–¥–Ω—É—é —Å—Ç—Ä–æ–∫—É");

// –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–∞–Ω–Ω—ã–µ –æ –∑–∞–∫–ª–∏–Ω–∞–Ω–∏—è—Ö, –∏—Å–ø–æ–ª—å–∑—É—è await –±–µ–∑ async-—Ñ—É–Ω–∫—Ü–∏–∏
const response = await fetch(dataUrl);
const {spell: spells} = await response.json();

// –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
const getRandomNumber = (a, b) => Math.floor(Math.random() * (b - a) + a);
const getRandomSpells = (n) => {
    let randomSpells = [];
    for (let i = 0; i < n; i++) {
        randomSpells.push(spells[getRandomNumber(0, spells.length)])
    }
    return randomSpells;
}

// –î–æ—Å—Ç—É–ø–Ω—ã–µ –¥–ª—è –ø–æ–∫—É–ø–∫–∏ —Å–≤–∏—Ç–∫–∏
const scrolls = getRandomSpells(getRandomNumber(scrollsStock.min, scrollsStock.max + 1));
// –í–ª–∞–¥–µ–ª–µ—Ü –º–∞–≥–∞–∑–∏–Ω–∞ –º–æ–∂–µ—Ç –ø–æ–ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å –ø–æ–∫—É–ø–∞—Ç–µ–ª—è –æ–¥–Ω–∏–º –∏–∑ —Å–ª–µ–¥—É—é—â–∏—Ö —Å–ø–æ—Å–æ–±–æ–≤ 
const welcomePhrases = [
    "Welcome to our shop, traveller. I hope you find something useful here.",
    "Sometimes even small peace of parchment can turn the tables. You should buy one!",
    "Hello there! Only the best scrolls! High quality magic!"
]
---
<!-- –õ–æ–∫–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ -->
<style lang="scss">
/* –¢–æ–ª—å–∫–æ —Å—Ç–∏–ª—å –¥–ª—è ul –±—É–¥–µ—Ç –≥–ª–æ–±–∞–ª—å–Ω—ã–º */
    :global(ul) {
        list-style-type: none;
        margin: 0;
        padding: 0;
    }

    .scrolls-for-sale {
        li::before {
            content: "üìú";
            margin-right: .3rem;
        }
    }

    @for $i from 0 through 9 {
        .item-name[data-level="#{$i}"] {
            color: adjust-hue(#4903fc, $i*36deg);
        }
    }
</style>

<!-- –ó–Ω–∞–∫–æ–º—ã–π JSX —Å–∏–Ω—Ç–∞–∫—Å–∏—Å -->
<div class="shop">
    <slot name="shop-title">
        <h2>Magic shop</h2>
    </slot>
    <p>{welcomePhrases[getRandomNumber(0, welcomePhrases.length)]}</p>
    <ul class="scrolls-for-sale">
        {scrolls.map((scroll) => (
            <li>
                <span class="item-name" data-level={scroll.level}>{`${scroll.name} `}</span>
                <span class="item-price">{scroll.level * 100 + (scroll.level? 0 : 20)}G</span>
            </li>
        ))}
    </ul>
</div>